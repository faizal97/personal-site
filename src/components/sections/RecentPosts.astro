---
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  });
}
---

<div class="space-y-8">
  <!-- Section header -->
  <div>
    <div class="reveal-up">
      <span class="heading-section accent-line">Blog</span>
    </div>
    <h2 class="reveal-up reveal-delay-1 heading-lg mt-4">
      Recent writing
    </h2>
  </div>

  <!-- Post list with dividers -->
  <div class="divide-y divide-[var(--border)]">
    {posts.map((post, index) => (
      <a
        href={`/blog/${post.id}`}
        class={`reveal-up reveal-delay-${index + 2} group flex flex-col md:flex-row md:items-center gap-2 md:gap-4 py-6 first:pt-0`}
      >
        <div class="flex-1">
          <h3 class="font-display text-lg font-bold group-hover:text-[var(--color-accent)] transition-colors duration-200">
            {post.data.title}
          </h3>
          <p class="text-sm text-[var(--muted)] mt-1 line-clamp-1">
            {post.data.description}
          </p>
        </div>
        <div class="flex items-center gap-3 shrink-0">
          <time
            class="font-mono text-xs text-[var(--muted)]"
            datetime={post.data.pubDate.toISOString()}
          >
            {formatDate(post.data.pubDate)}
          </time>
          <svg class="w-4 h-4 text-[var(--muted)] group-hover:text-[var(--color-accent)] group-hover:translate-x-1 transition-all duration-200 hidden md:block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
        </div>
      </a>
    ))}
  </div>

  <!-- View all link -->
  <div class="reveal-up reveal-delay-5">
    <a
      href="/blog"
      class="group inline-flex items-center gap-2 font-mono text-xs uppercase tracking-widest text-[var(--muted)] hover:text-[var(--color-accent)] transition-colors duration-200"
    >
      All posts
      <svg class="w-3 h-3 group-hover:translate-x-1 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
    </a>
  </div>
</div>
