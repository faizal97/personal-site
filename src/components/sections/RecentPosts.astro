---
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  });
}
---

<section class="section-padding">
  <div class="max-w-6xl mx-auto px-6">
    <div class="flex items-end justify-between mb-12">
      <h2
        class="reveal text-3xl md:text-4xl font-700"
        style="font-family: var(--font-display);"
      >
        Blog<span class="text-[var(--color-accent)]">.</span>
      </h2>
      <a
        href="/blog"
        class="reveal text-sm text-[var(--muted)] hover:text-[var(--color-accent)] transition-colors duration-200"
        style="font-family: var(--font-mono);"
      >
        All posts &rarr;
      </a>
    </div>

    <div class="space-y-4">
      {posts.map((post, index) => (
        <a
          href={`/blog/${post.id}`}
          class={`reveal reveal-delay-${index + 1} card-base rounded-lg p-6 flex flex-col md:flex-row md:items-center gap-4 group block`}
        >
          <time
            class="text-xs text-[var(--muted)] whitespace-nowrap"
            style="font-family: var(--font-mono);"
            datetime={post.data.pubDate.toISOString()}
          >
            {formatDate(post.data.pubDate)}
          </time>
          <div class="flex-1">
            <h3
              class="text-lg font-600 group-hover:text-[var(--color-accent)] transition-colors duration-200"
              style="font-family: var(--font-display);"
            >
              {post.data.title}
            </h3>
            <p
              class="text-sm text-[var(--muted)] mt-1 line-clamp-1"
              style="font-family: var(--font-body);"
            >
              {post.data.description}
            </p>
          </div>
          <svg class="w-4 h-4 text-[var(--muted)] group-hover:text-[var(--color-accent)] transition-colors shrink-0 hidden md:block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
        </a>
      ))}
    </div>
  </div>
</section>
