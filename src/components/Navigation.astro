---
import ThemeToggle from './ThemeToggle.astro';

const navItems = [
  { label: 'About', href: '/#about' },
  { label: 'Skills', href: '/#skills' },
  { label: 'Experience', href: '/#experience' },
  { label: 'Projects', href: '/projects' },
  { label: 'Blog', href: '/blog' },
  { label: 'Contact', href: '/#contact' },
];
---

<nav
  class="fixed top-0 left-0 right-0 z-50 mix-blend-difference pointer-events-none"
>
  <div class="grid-max h-16 flex items-center justify-between pointer-events-auto">
    <!-- Logo -->
    <a
      href="/"
      class="font-display font-extrabold text-lg tracking-tight text-white hover:text-[var(--color-accent)] transition-colors duration-200"
    >
      FAP<span class="text-[var(--color-accent)]">.</span>
    </a>

    <!-- Desktop nav -->
    <div class="hidden md:flex items-center gap-1">
      {navItems.map((item, i) => (
        <>
          <a
            href={item.href}
            class="font-mono text-xs uppercase tracking-widest text-white/80 hover:text-[var(--color-accent)] transition-colors duration-200 px-3 py-2"
          >
            {item.label}
          </a>
          {i < navItems.length - 1 && (
            <span class="text-white/30 text-xs">/</span>
          )}
        </>
      ))}
      <div class="ml-4">
        <ThemeToggle />
      </div>
    </div>

    <!-- Mobile hamburger -->
    <div class="flex items-center gap-3 md:hidden">
      <ThemeToggle />
      <button
        id="mobile-menu-btn"
        type="button"
        aria-label="Toggle menu"
        class="w-10 h-10 flex flex-col items-center justify-center gap-2 cursor-pointer relative"
      >
        <span class="hamburger-line block w-6 h-0.5 bg-white transition-all duration-300 origin-center"></span>
        <span class="hamburger-line block w-6 h-0.5 bg-white transition-all duration-300 origin-center"></span>
      </button>
    </div>
  </div>
</nav>

<!-- Full-screen mobile overlay -->
<div
  id="mobile-overlay"
  class="fixed inset-0 z-[100] flex items-center justify-center bg-[var(--color-dark-bg)] transition-opacity duration-300 opacity-0 pointer-events-none md:hidden"
>
  <button
    id="mobile-overlay-close"
    type="button"
    aria-label="Close menu"
    class="absolute top-5 right-6 w-10 h-10 flex items-center justify-center cursor-pointer"
  >
    <span class="block w-6 h-0.5 bg-white rotate-45 absolute"></span>
    <span class="block w-6 h-0.5 bg-white -rotate-45 absolute"></span>
  </button>

  <nav class="flex flex-col items-center gap-8">
    {navItems.map((item) => (
      <a
        href={item.href}
        class="mobile-overlay-link font-display text-3xl font-bold text-white hover:text-[var(--color-accent)] transition-colors duration-200"
      >
        {item.label}
      </a>
    ))}
  </nav>
</div>

<style>
  .menu-open .hamburger-line:nth-child(1) {
    transform: translateY(5px) rotate(45deg);
  }
  .menu-open .hamburger-line:nth-child(2) {
    transform: translateY(-5px) rotate(-45deg);
  }
</style>

<script>
  function initMobileMenu() {
    const btn = document.getElementById('mobile-menu-btn');
    const overlay = document.getElementById('mobile-overlay');
    const closeBtn = document.getElementById('mobile-overlay-close');
    if (!btn || !overlay) return;

    function openMenu() {
      overlay.classList.remove('opacity-0', 'pointer-events-none');
      overlay.classList.add('opacity-100', 'pointer-events-auto');
      btn.classList.add('menu-open');
      document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
      overlay.classList.add('opacity-0', 'pointer-events-none');
      overlay.classList.remove('opacity-100', 'pointer-events-auto');
      btn.classList.remove('menu-open');
      document.body.style.overflow = '';
    }

    btn.addEventListener('click', () => {
      overlay.classList.contains('opacity-100') ? closeMenu() : openMenu();
    });

    closeBtn?.addEventListener('click', closeMenu);

    overlay.querySelectorAll('.mobile-overlay-link').forEach((link) => {
      link.addEventListener('click', closeMenu);
    });
  }

  initMobileMenu();
  document.addEventListener('astro:after-swap', initMobileMenu);
</script>
